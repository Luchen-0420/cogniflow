# è¯­éŸ³è¾“å…¥åŠŸèƒ½æ–‡æ¡£

## åŠŸèƒ½æ¦‚è¿°

CogniFlow ç°å·²æ”¯æŒè¯­éŸ³è¾“å…¥åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡éº¦å…‹é£ç›´æ¥å°†è¯­éŸ³è½¬æ¢ä¸ºæ–‡å­—ï¼Œæé«˜è¾“å…¥æ•ˆç‡ã€‚

## åŠŸèƒ½ç‰¹æ€§

### 1. æ ¸å¿ƒåŠŸèƒ½
- âœ… **å®æ—¶è¯­éŸ³è¯†åˆ«**ï¼šä½¿ç”¨ Web Speech API å®ç°å®æ—¶è¯­éŸ³è½¬æ–‡å­—
- âœ… **ä¸­æ–‡æ”¯æŒ**ï¼šé»˜è®¤æ”¯æŒä¸­æ–‡è¯­éŸ³è¯†åˆ«
- âœ… **è¿ç»­è¯†åˆ«**ï¼šæ”¯æŒæŒç»­å½•éŸ³å’Œè¯†åˆ«
- âœ… **å®æ—¶é¢„è§ˆ**ï¼šæ˜¾ç¤ºæ­£åœ¨è¯†åˆ«çš„ä¸´æ—¶æ–‡æœ¬
- âœ… **æ™ºèƒ½è¿½åŠ **ï¼šè¯†åˆ«ç»“æœè‡ªåŠ¨è¿½åŠ åˆ°è¾“å…¥æ¡†

### 2. ç”¨æˆ·ä½“éªŒ
- ğŸ¤ **ç›´è§‚çš„æŒ‰é’®è®¾è®¡**ï¼šéº¦å…‹é£å›¾æ ‡æŒ‰é’®
- ğŸ”´ **å½•éŸ³çŠ¶æ€æŒ‡ç¤º**ï¼šå½•éŸ³æ—¶æŒ‰é’®å˜ä¸ºçº¢è‰²å¹¶å¸¦æœ‰è„‰å†²åŠ¨ç”»
- ğŸ’¬ **å®æ—¶åé¦ˆ**ï¼šæ˜¾ç¤ºæ­£åœ¨è¯†åˆ«çš„æ–‡æœ¬é¢„è§ˆ
- ğŸ”” **å‹å¥½æç¤º**ï¼šä½¿ç”¨ toast æç¤ºæ“ä½œçŠ¶æ€å’Œé”™è¯¯ä¿¡æ¯

### 3. æµè§ˆå™¨å…¼å®¹æ€§
- âœ… Chrome/Edge (æ¨è)
- âœ… Safari
- âš ï¸ Firefox (éƒ¨åˆ†æ”¯æŒ)
- âŒ ä¸æ”¯æŒçš„æµè§ˆå™¨ä¼šæ˜¾ç¤ºå‹å¥½æç¤º

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨æµç¨‹

1. **å¯åŠ¨è¯­éŸ³è¾“å…¥**
   - ç‚¹å‡»è¾“å…¥æ¡†å·¦ä¾§çš„éº¦å…‹é£å›¾æ ‡ ğŸ¤
   - æµè§ˆå™¨ä¼šè¯·æ±‚éº¦å…‹é£æƒé™ï¼ˆé¦–æ¬¡ä½¿ç”¨æ—¶ï¼‰
   - æŒ‰é’®å˜ä¸ºçº¢è‰²å¹¶å¼€å§‹è„‰å†²åŠ¨ç”»ï¼Œè¡¨ç¤ºæ­£åœ¨å½•éŸ³

2. **è¯­éŸ³è¾“å…¥**
   - å¯¹ç€éº¦å…‹é£è¯´è¯
   - ç³»ç»Ÿä¼šå®æ—¶æ˜¾ç¤ºè¯†åˆ«çš„æ–‡æœ¬
   - è¯†åˆ«çš„æ–‡æœ¬ä¼šè‡ªåŠ¨è¿½åŠ åˆ°è¾“å…¥æ¡†ä¸­

3. **åœæ­¢å½•éŸ³**
   - å†æ¬¡ç‚¹å‡»éº¦å…‹é£æŒ‰é’®å³å¯åœæ­¢å½•éŸ³
   - æˆ–ç­‰å¾…ç³»ç»Ÿè‡ªåŠ¨ç»“æŸè¯†åˆ«

### ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

#### åœºæ™¯ 1ï¼šå¿«é€Ÿåˆ›å»ºä»»åŠ¡
```
ç‚¹å‡»éº¦å…‹é£ â†’ è¯´"æ˜å¤©ä¸‹åˆä¸‰ç‚¹å¼€ä¼šè®¨è®ºé¡¹ç›®è¿›åº¦" â†’ åœæ­¢å½•éŸ³
ç»“æœï¼šæ–‡å­—è‡ªåŠ¨å‡ºç°åœ¨è¾“å…¥æ¡†ä¸­
```

#### åœºæ™¯ 2ï¼šé•¿ç¯‡ç¬”è®°
```
ç‚¹å‡»éº¦å…‹é£ â†’ æŒç»­è¯´è¯è®°å½•ä¼šè®®å†…å®¹ â†’ åœæ­¢å½•éŸ³
ç»“æœï¼šå®Œæ•´çš„ä¼šè®®è®°å½•æ–‡æœ¬
```

#### åœºæ™¯ 3ï¼šé…åˆæ–‡æœ¬è¾“å…¥
```
æ‰‹åŠ¨è¾“å…¥ä¸€éƒ¨åˆ† â†’ ç‚¹å‡»éº¦å…‹é£è¡¥å……è¯­éŸ³å†…å®¹ â†’ è¯­éŸ³æ–‡æœ¬è‡ªåŠ¨è¿½åŠ 
```

## æŠ€æœ¯å®ç°

### æ¶æ„è®¾è®¡

```
src/
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useSpeechRecognition.ts    # è¯­éŸ³è¯†åˆ« Hook
â””â”€â”€ components/
    â””â”€â”€ voice/
        â””â”€â”€ VoiceInputButton.tsx    # è¯­éŸ³è¾“å…¥æŒ‰é’®ç»„ä»¶
```

### æ ¸å¿ƒç»„ä»¶

#### 1. useSpeechRecognition Hook

**åŠŸèƒ½**ï¼šå°è£… Web Speech APIï¼Œæä¾›ç»Ÿä¸€çš„è¯­éŸ³è¯†åˆ«æ¥å£

**ä¸»è¦ç‰¹æ€§**ï¼š
- æµè§ˆå™¨å…¼å®¹æ€§æ£€æµ‹
- è¯­éŸ³è¯†åˆ«ç”Ÿå‘½å‘¨æœŸç®¡ç†
- å®æ—¶å’Œæœ€ç»ˆç»“æœå¤„ç†
- é”™è¯¯å¤„ç†å’Œç”¨æˆ·å‹å¥½æç¤º
- TypeScript ç±»å‹æ”¯æŒ

**API**ï¼š
```typescript
interface UseSpeechRecognitionReturn {
  isListening: boolean;          // æ˜¯å¦æ­£åœ¨ç›‘å¬
  isSupported: boolean;          // æµè§ˆå™¨æ˜¯å¦æ”¯æŒ
  transcript: string;            // æœ€ç»ˆè¯†åˆ«æ–‡æœ¬
  interimTranscript: string;     // å®æ—¶ä¸´æ—¶æ–‡æœ¬
  error: string | null;          // é”™è¯¯ä¿¡æ¯
  startListening: () => void;    // å¼€å§‹ç›‘å¬
  stopListening: () => void;     // åœæ­¢ç›‘å¬
  resetTranscript: () => void;   // é‡ç½®æ–‡æœ¬
}
```

**é…ç½®é€‰é¡¹**ï¼š
```typescript
interface UseSpeechRecognitionOptions {
  lang?: string;                 // è¯­è¨€ï¼ˆé»˜è®¤ï¼š'zh-CN'ï¼‰
  continuous?: boolean;          // è¿ç»­è¯†åˆ«ï¼ˆé»˜è®¤ï¼šfalseï¼‰
  interimResults?: boolean;      // å®æ—¶ç»“æœï¼ˆé»˜è®¤ï¼štrueï¼‰
  onResult?: (transcript: string, isFinal: boolean) => void;
  onError?: (error: string) => void;
  onEnd?: () => void;
}
```

#### 2. VoiceInputButton ç»„ä»¶

**åŠŸèƒ½**ï¼šæä¾›è¯­éŸ³è¾“å…¥çš„ç”¨æˆ·ç•Œé¢å’Œäº¤äº’

**ä¸»è¦ç‰¹æ€§**ï¼š
- å½•éŸ³çŠ¶æ€è§†è§‰åé¦ˆï¼ˆé¢œè‰²ã€åŠ¨ç”»ï¼‰
- å®æ—¶è¯†åˆ«æ–‡æœ¬é¢„è§ˆæµ®å±‚
- æƒé™è¯·æ±‚å’Œé”™è¯¯å¤„ç†
- å®Œå…¨å¯å®šåˆ¶çš„æ ·å¼

**Props**ï¼š
```typescript
interface VoiceInputButtonProps {
  onTranscript: (text: string) => void;  // è¯†åˆ«ç»“æœå›è°ƒ
  disabled?: boolean;                    // æ˜¯å¦ç¦ç”¨
  className?: string;                    // è‡ªå®šä¹‰æ ·å¼
  size?: 'default' | 'sm' | 'lg' | 'icon';
  variant?: 'default' | 'outline' | 'ghost' | 'destructive' | 'secondary';
}
```

### é›†æˆç¤ºä¾‹

åœ¨ QuickInput ç»„ä»¶ä¸­çš„é›†æˆï¼š

```tsx
import { VoiceInputButton } from '@/components/voice/VoiceInputButton';

<VoiceInputButton
  onTranscript={(voiceText) => {
    setText((prev) => {
      const newText = prev ? `${prev} ${voiceText}` : voiceText;
      return newText;
    });
  }}
  disabled={isQuerying || isUploading}
  size="lg"
  className="h-[60px] px-3"
/>
```

## é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

| é”™è¯¯ç±»å‹ | é”™è¯¯ä¿¡æ¯ | è§£å†³æ–¹æ¡ˆ |
|---------|---------|---------|
| `not-allowed` | éº¦å…‹é£æƒé™è¢«æ‹’ç» | åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å…è®¸ç½‘ç«™è®¿é—®éº¦å…‹é£ |
| `audio-capture` | æ— æ³•è®¿é—®éº¦å…‹é£ | æ£€æŸ¥éº¦å…‹é£ç¡¬ä»¶è¿æ¥ |
| `no-speech` | æ²¡æœ‰æ£€æµ‹åˆ°è¯­éŸ³ | æ£€æŸ¥éº¦å…‹é£æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œé è¿‘éº¦å…‹é£è¯´è¯ |
| `network` | ç½‘ç»œé”™è¯¯ | æ£€æŸ¥ç½‘ç»œè¿æ¥çŠ¶æ€ |
| ä¸æ”¯æŒ | æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ« | ä½¿ç”¨ Chromeã€Edge æˆ– Safari æµè§ˆå™¨ |

### æƒé™ç®¡ç†

é¦–æ¬¡ä½¿ç”¨æ—¶ï¼Œæµè§ˆå™¨ä¼šå¼¹å‡ºæƒé™è¯·æ±‚å¯¹è¯æ¡†ï¼š
```
cogniflow.com æƒ³è¦ä½¿ç”¨æ‚¨çš„éº¦å…‹é£
[é˜»æ­¢] [å…è®¸]
```

**æ³¨æ„äº‹é¡¹**ï¼š
- å¿…é¡»é€‰æ‹©"å…è®¸"æ‰èƒ½ä½¿ç”¨è¯­éŸ³è¾“å…¥åŠŸèƒ½
- å¦‚æœè¯¯é€‰"é˜»æ­¢"ï¼Œéœ€è¦åœ¨æµè§ˆå™¨è®¾ç½®ä¸­æ‰‹åŠ¨å¼€å¯
- HTTPS ç¯å¢ƒä¸‹æ‰èƒ½è¯·æ±‚éº¦å…‹é£æƒé™ï¼ˆlocalhost é™¤å¤–ï¼‰

## æµè§ˆå™¨å…¼å®¹æ€§è¯¦æƒ…

### å®Œå…¨æ”¯æŒ
- âœ… Chrome 25+ (æ¡Œé¢å’Œç§»åŠ¨ç«¯)
- âœ… Edge 79+
- âœ… Safari 14.1+ (éœ€è¦ç”¨æˆ·æ‰‹åŠ¿è§¦å‘)

### éƒ¨åˆ†æ”¯æŒ
- âš ï¸ Firefox æ²¡æœ‰åŸç”Ÿæ”¯æŒ Web Speech API
- âš ï¸ Opera åŸºäº Chromiumï¼Œæ”¯æŒæƒ…å†µåŒ Chrome

### ä¸æ”¯æŒ
- âŒ Internet Explorer
- âŒ å¤§éƒ¨åˆ†å›½äº§æµè§ˆå™¨ï¼ˆå¦‚æœåŸºäºæ—§ç‰ˆå†…æ ¸ï¼‰

### æ£€æµ‹ä»£ç 
```typescript
const isSupported = !!(
  window.SpeechRecognition || 
  window.webkitSpeechRecognition
);
```

## æ€§èƒ½ä¼˜åŒ–

### 1. èµ„æºç®¡ç†
- ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨åœæ­¢è¯­éŸ³è¯†åˆ«
- é¿å…å†…å­˜æ³„æ¼

### 2. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- ä½¿ç”¨ `continuous: true` æ”¯æŒé•¿æ—¶é—´å½•éŸ³
- ä½¿ç”¨ `interimResults: true` æä¾›å®æ—¶åé¦ˆ
- åˆç†çš„é˜²æŠ–å¤„ç†

### 3. é”™è¯¯æ¢å¤
- è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼ˆéƒ¨åˆ†é”™è¯¯ï¼‰
- å‹å¥½çš„é”™è¯¯æç¤º

## éšç§å’Œå®‰å…¨

### æ•°æ®å¤„ç†
- âœ… è¯­éŸ³æ•°æ®ä»…åœ¨å®¢æˆ·ç«¯å¤„ç†
- âœ… ä½¿ç”¨æµè§ˆå™¨å†…ç½®çš„ Speech API
- âœ… ä¸ä¼šä¸Šä¼ éŸ³é¢‘åˆ°æœåŠ¡å™¨
- âœ… ä»…è·å–æ–‡æœ¬è¯†åˆ«ç»“æœ

### æƒé™æ§åˆ¶
- ç”¨æˆ·å¿…é¡»æ˜ç¡®æˆæƒéº¦å…‹é£æƒé™
- å¯ä»¥éšæ—¶æ’¤é”€æƒé™
- å½•éŸ³çŠ¶æ€æœ‰æ˜æ˜¾çš„è§†è§‰æŒ‡ç¤º

## æœªæ¥è®¡åˆ’

### çŸ­æœŸè®¡åˆ’
- [ ] æ”¯æŒæ›´å¤šè¯­è¨€åˆ‡æ¢ï¼ˆè‹±æ–‡ã€æ—¥æ–‡ç­‰ï¼‰
- [ ] æ·»åŠ è¯­éŸ³å‘½ä»¤æ”¯æŒï¼ˆå¦‚"æ–°å»ºä»»åŠ¡"ï¼‰
- [ ] ä¼˜åŒ–è¯†åˆ«å‡†ç¡®ç‡

### é•¿æœŸè®¡åˆ’
- [ ] æ¥å…¥ç¬¬ä¸‰æ–¹è¯­éŸ³è¯†åˆ«æœåŠ¡ï¼ˆæé«˜å‡†ç¡®ç‡ï¼‰
- [ ] æ”¯æŒæ–¹è¨€è¯†åˆ«
- [ ] æ·»åŠ è¯­éŸ³æ ‡ç‚¹ç¬¦å·

## æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•
1. âœ… æµ‹è¯•å¯åŠ¨å’Œåœæ­¢å½•éŸ³
2. âœ… æµ‹è¯•å®æ—¶è¯†åˆ«æ˜¾ç¤º
3. âœ… æµ‹è¯•æœ€ç»ˆæ–‡æœ¬è¾“å‡º
4. âœ… æµ‹è¯•æƒé™æ‹’ç»åœºæ™¯
5. âœ… æµ‹è¯•æµè§ˆå™¨ä¸æ”¯æŒåœºæ™¯

### å…¼å®¹æ€§æµ‹è¯•
1. âœ… Chrome æµè§ˆå™¨
2. âœ… Edge æµè§ˆå™¨
3. âœ… Safari æµè§ˆå™¨
4. âœ… ç§»åŠ¨ç«¯æµè§ˆå™¨

### åœºæ™¯æµ‹è¯•
1. âœ… å®‰é™ç¯å¢ƒä¸‹çš„è¯†åˆ«
2. âš ï¸ å˜ˆæ‚ç¯å¢ƒä¸‹çš„è¯†åˆ«ï¼ˆå¯èƒ½å½±å“å‡†ç¡®ç‡ï¼‰
3. âœ… é•¿æ—¶é—´è¿ç»­å½•éŸ³
4. âœ… ä¸­è‹±æ–‡æ··åˆè¾“å…¥

## æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šç‚¹å‡»æŒ‰é’®æ²¡æœ‰ååº”
**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒ Web Speech API
2. æ£€æŸ¥æ˜¯å¦æˆäºˆäº†éº¦å…‹é£æƒé™
3. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹é”™è¯¯ä¿¡æ¯

### é—®é¢˜ï¼šè¯†åˆ«ç»“æœä¸å‡†ç¡®
**å¯èƒ½åŸå› **ï¼š
1. éº¦å…‹é£è´¨é‡é—®é¢˜
2. ç¯å¢ƒå™ªéŸ³è¿‡å¤§
3. è¯´è¯ä¸å¤Ÿæ¸…æ™°
4. ç½‘ç»œå»¶è¿Ÿï¼ˆéƒ¨åˆ†æµè§ˆå™¨ï¼‰

**æ”¹è¿›å»ºè®®**ï¼š
- ä½¿ç”¨è´¨é‡è¾ƒå¥½çš„éº¦å…‹é£
- åœ¨å®‰é™ç¯å¢ƒä¸‹ä½¿ç”¨
- è¯´è¯æ¸…æ™°ã€è¯­é€Ÿé€‚ä¸­
- ä½¿ç”¨æœ‰çº¿ç½‘ç»œ

### é—®é¢˜ï¼šæƒé™è¢«æ‹’ç»
**è§£å†³æ–¹æ³•**ï¼š
1. Chrome/Edgeï¼šåœ°å€æ å·¦ä¾§ç‚¹å‡»é”å›¾æ ‡ â†’ ç½‘ç«™è®¾ç½® â†’ éº¦å…‹é£ â†’ å…è®¸
2. Safariï¼šSafari èœå• â†’ åå¥½è®¾ç½® â†’ ç½‘ç«™ â†’ éº¦å…‹é£ â†’ å…è®¸
3. åˆ·æ–°é¡µé¢é‡æ–°è¯·æ±‚æƒé™

## å¼€å‘è€…æŒ‡å—

### ä½¿ç”¨ useSpeechRecognition Hook

```typescript
import { useSpeechRecognition } from '@/hooks/useSpeechRecognition';

function MyComponent() {
  const {
    isListening,
    transcript,
    startListening,
    stopListening,
  } = useSpeechRecognition({
    lang: 'zh-CN',
    continuous: true,
    onResult: (text, isFinal) => {
      if (isFinal) {
        console.log('æœ€ç»ˆç»“æœ:', text);
      }
    },
  });

  return (
    <button onClick={isListening ? stopListening : startListening}>
      {isListening ? 'åœæ­¢' : 'å¼€å§‹'}
    </button>
  );
}
```

### è‡ªå®šä¹‰ VoiceInputButton

```typescript
<VoiceInputButton
  onTranscript={(text) => console.log(text)}
  variant="default"
  size="sm"
  className="custom-class"
/>
```

## æ€»ç»“

è¯­éŸ³è¾“å…¥åŠŸèƒ½ä¸º CogniFlow æä¾›äº†æ›´ä¾¿æ·çš„è¾“å…¥æ–¹å¼ï¼Œç‰¹åˆ«é€‚åˆï¼š
- éœ€è¦å¿«é€Ÿè®°å½•æƒ³æ³•çš„åœºæ™¯
- é•¿ç¯‡ç¬”è®°çš„è¾“å…¥
- æ‰‹ä¸æ–¹ä¾¿æ‰“å­—çš„æƒ…å†µ
- ç§»åŠ¨ç«¯ç”¨æˆ·

é€šè¿‡è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒè®¾è®¡å’Œå®Œå–„çš„é”™è¯¯å¤„ç†ï¼Œç¡®ä¿åŠŸèƒ½ç¨³å®šå¯é ã€‚
