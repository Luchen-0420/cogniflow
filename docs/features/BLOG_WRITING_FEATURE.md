# 博客写作功能 - 功能文档

## 📝 功能概述

新增博客写作功能，支持用户通过 `/blog` 指令快速打开专业的 Markdown 编辑器，进行文章创作。编辑器支持实时预览、自动保存草稿，完成后由 AI 自动提取标题和标签，并保存为笔记卡片。

## ✨ 核心特性

### 1. 快速启动编辑器
- **触发方式**：在输入框中输入 `/blog` 即可打开编辑器
- **即时响应**：输入后立即弹出编辑器，清空输入框

### 2. 专业 Markdown 编辑器
- **技术栈**：使用 `@uiw/react-md-editor` 作为核心编辑器
- **实时预览**：左侧编辑，右侧实时预览效果
- **完整语法支持**：
  - 标题 (`# ## ###`)
  - 加粗/斜体 (`**bold** *italic*`)
  - 列表 (有序/无序)
  - 代码块 (带语法高亮)
  - 链接 (`[text](url)`)
  - 图片 (`![alt](url)`)
  - 引用 (`>`)
  - 表格
  - 等等...

### 3. 自动保存草稿
- **本地存储**：利用 `localStorage` 自动保存草稿
- **保存时机**：用户停止输入 1 秒后自动保存
- **状态提示**：显示最后保存时间（如 "✓ 已自动保存 14:30:25"）
- **草稿恢复**：下次打开编辑器时自动加载上次的草稿
- **字数统计**：实时显示当前文章字数

### 4. AI 智能提取
- **自动提取标题**：
  - 优先使用 Markdown 一级标题 (`# 标题`)
  - 如无，则由 AI 根据内容生成简洁标题（10-30字）
  
- **智能生成描述**：
  - 提取文章核心观点作为描述
  - 自动去除 Markdown 语法
  - 限制在 100 字以内
  
- **标签推荐**：
  - AI 分析文章内容，生成 3-5 个相关标签
  - 标签包括技术栈、领域、主题等
  - 自动添加 "博客" 标签

### 5. 一键保存归类
- **保存流程**：
  1. 点击"保存并归类"按钮
  2. AI 分析文章内容（提取标题、描述、标签）
  3. 创建笔记类型卡片
  4. 显示成功提示，包含文章标题
  5. 清除草稿，关闭编辑器
  
- **API 用量检查**：保存前会检查用户的 API 用量限额

### 6. 用户体验优化
- **全屏编辑**：使用 90vh 高度，提供沉浸式写作体验
- **响应式设计**：适配不同屏幕尺寸
- **深色模式**：自动适配系统主题
- **友好提示**：底部显示使用提示和功能说明

## 🎯 使用流程

```
用户输入 /blog
    ↓
打开编辑器弹窗
    ↓
用户写作（自动保存草稿）
    ↓
点击"保存并归类"
    ↓
AI 提取元数据（标题、描述、标签）
    ↓
创建笔记卡片
    ↓
显示成功提示
```

## 📁 文件结构

```
src/
├── components/
│   └── blog/
│       └── BlogEditorDialog.tsx        # 博客编辑器组件
├── utils/
│   └── ai.ts                           # AI 提取服务
└── components/items/
    └── QuickInput.tsx                  # 集成 /blog 指令
```

## 🔧 技术实现

### 1. BlogEditorDialog 组件

**主要功能**：
- 使用 `MDEditor` 作为核心编辑器
- 实现自动保存逻辑（debounce 1秒）
- 提供保存、关闭按钮
- 字数统计
- 草稿管理

**关键代码**：
```tsx
// 自动保存
const autoSave = useCallback((newContent: string) => {
  if (saveTimeoutRef.current) {
    clearTimeout(saveTimeoutRef.current);
  }
  saveTimeoutRef.current = setTimeout(() => {
    localStorage.setItem('blog_draft', newContent);
    setLastSaved(new Date());
  }, 1000);
}, []);
```

### 2. AI 提取服务

**extractBlogMetadata 函数**：
- 输入：Markdown 格式的博客内容
- 输出：`{ title, description, tags }`
- 使用 AI 分析内容，生成元数据
- 提供本地后备方案（AI 失败时使用）

**后备策略**：
```typescript
// 提取 Markdown 一级标题
function extractMarkdownTitle(content: string): string | null

// 提取第一段作为描述
function extractFirstParagraph(content: string): string
```

### 3. QuickInput 集成

**指令检测**：
```tsx
const handleTextChange = (value: string) => {
  // 检测 /blog 指令
  if (value.trim().toLowerCase() === '/blog') {
    setShowBlogEditor(true);
    setText('');
    return;
  }
  // ...其他逻辑
}
```

**保存处理**：
```tsx
const handleBlogSave = async (content: string) => {
  // 1. 检查用户和 API 用量
  // 2. 调用 AI 提取元数据
  // 3. 创建笔记卡片
  // 4. 显示成功提示
}
```

## 📋 依赖包

```json
{
  "@uiw/react-md-editor": "^4.0.8",
  "rehype-sanitize": "^6.0.0"
}
```

## 🎨 UI/UX 设计

### 编辑器界面
- **顶部栏**：标题、描述、字数统计、保存时间
- **主体区**：左侧编辑 | 右侧预览（50/50 分屏）
- **底部栏**：使用提示

### 交互反馈
- ✓ 已自动保存（绿色）
- 正在分析文章内容...（加载状态）
- 博客文章《xxx》已保存到笔记卡片（成功提示）

## 🚀 使用示例

### 示例 1：技术博客
```markdown
# React Hooks 深度解析

在现代 React 开发中，Hooks 已经成为...

## useState 的使用
...

## useEffect 的依赖管理
...
```

**AI 提取结果**：
- 标题：`React Hooks 深度解析`
- 描述：`在现代 React 开发中，Hooks 已经成为...`
- 标签：`["React", "Hooks", "前端开发", "博客"]`

### 示例 2：生活记录
```markdown
# 2024年终总结

今年是充实的一年...

## 工作方面
完成了 3 个重要项目...

## 学习成长
...
```

**AI 提取结果**：
- 标题：`2024年终总结`
- 描述：`今年是充实的一年...`
- 标签：`["年终总结", "回顾", "个人成长", "博客"]`

## 💡 使用提示

1. **快捷键**：
   - `Ctrl/Cmd + B`：加粗
   - `Ctrl/Cmd + I`：斜体
   - `Ctrl/Cmd + K`：插入链接

2. **草稿管理**：
   - 编辑器会自动保存草稿到本地
   - 即使关闭浏览器，草稿依然保留
   - 保存成功后自动清除草稿

3. **最佳实践**：
   - 使用一级标题作为文章标题
   - 合理使用标题层级（H1 > H2 > H3）
   - 添加代码块时指定语言（语法高亮）
   - 定期点击"保存并归类"避免丢失

## 🔮 未来优化方向

1. **图片上传**：
   - 支持拖拽上传图片
   - 自动上传到云存储
   - 自动插入 Markdown 图片语法

2. **模板系统**：
   - 提供常用博客模板
   - 技术文章模板
   - 读书笔记模板
   - 周报模板

3. **协作功能**：
   - 支持文章分享链接
   - 支持多人协作编辑
   - 版本历史管理

4. **导出功能**：
   - 导出为 PDF
   - 导出为 HTML
   - 一键发布到博客平台

## 📝 更新日志

### v1.0.0 (2024-11-11)
- ✅ 实现 `/blog` 指令触发
- ✅ 集成 Markdown 编辑器
- ✅ 实现自动保存草稿
- ✅ AI 智能提取标题和标签
- ✅ 保存为笔记卡片
- ✅ 更新帮助文档

## 🤝 贡献

如有问题或建议，欢迎提出 Issue 或 Pull Request。
