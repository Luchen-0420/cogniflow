# CogniFlow ä¸€é”®éƒ¨ç½²æŒ‡å—

## ğŸš€ å”¯ä¸€éƒ¨ç½²æ–¹å¼

CogniFlow æä¾›**å”¯ä¸€ä¸”å®Œæ•´çš„ä¸€é”®éƒ¨ç½²è„šæœ¬**ï¼Œæ— éœ€ä»»ä½•è¿ç§»æ“ä½œã€‚

```bash
./deploy-all.sh
```

## âš ï¸ é‡è¦è¯´æ˜

- **æ­¤è„šæœ¬ä¼šæ¸…ç©ºæ‰€æœ‰ç°æœ‰æ•°æ®**
- åŒ…å«æœ€æ–°çš„æ‰€æœ‰åŠŸèƒ½ï¼ˆåŒ…æ‹¬ API ä½¿ç”¨æ¬¡æ•°é™åˆ¶ï¼‰
- é€‚ç”¨äºæ–°éƒ¨ç½²å’Œé‡æ–°éƒ¨ç½²
- ä¸éœ€è¦å•ç‹¬çš„è¿ç§»è„šæœ¬

## ğŸ“‹ éƒ¨ç½²æµç¨‹

### 1. ç¡®è®¤ç¯å¢ƒ

ç¡®ä¿å·²å®‰è£…ä»¥ä¸‹å·¥å…·ï¼š
- Docker
- Docker Compose
- Node.js (v18+)
- pnpm

### 2. æ‰§è¡Œéƒ¨ç½²

```bash
# è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd /path/to/cogniflow

# æ‰§è¡Œä¸€é”®éƒ¨ç½²
./deploy-all.sh
```

### 3. ç¡®è®¤æ“ä½œ

è„šæœ¬ä¼šè¦æ±‚ä½ ç¡®è®¤ï¼š
```
è­¦å‘Š: æ­¤æ“ä½œå°†åˆ é™¤æ‰€æœ‰ç°æœ‰æ•°æ®ï¼

ç¡®è®¤ç»§ç»­éƒ¨ç½²? (è¾“å…¥ yes ç»§ç»­):
```

è¾“å…¥ `yes` ç»§ç»­ã€‚

### 4. ç­‰å¾…å®Œæˆ

è„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
1. âœ… åœæ­¢å¹¶åˆ é™¤æ—§å®¹å™¨å’Œæ•°æ®å·
2. âœ… å¯åŠ¨æ–°çš„ PostgreSQL å®¹å™¨
3. âœ… åˆå§‹åŒ–æ•°æ®åº“å’Œæ‰€æœ‰è¡¨ï¼ˆåŒ…å« API ä½¿ç”¨æ¬¡æ•°é™åˆ¶åŠŸèƒ½ï¼‰
4. âœ… å®‰è£…é¡¹ç›®ä¾èµ–
5. âœ… é…ç½®ç¯å¢ƒå˜é‡
6. âœ… æ˜¾ç¤ºéƒ¨ç½²ä¿¡æ¯

## ğŸ¯ éƒ¨ç½²åæ“ä½œ

### å¯åŠ¨æœåŠ¡

**æ–¹å¼ä¸€ï¼šåŒæ—¶å¯åŠ¨å‰åç«¯ï¼ˆæ¨èï¼‰**
```bash
pnpm run dev:postgres
```

**æ–¹å¼äºŒï¼šåˆ†åˆ«å¯åŠ¨**
```bash
# ç»ˆç«¯1ï¼šå¯åŠ¨åç«¯
cd server && pnpm run dev

# ç»ˆç«¯2ï¼šå¯åŠ¨å‰ç«¯
pnpm run dev
```

### éªŒè¯éƒ¨ç½²

```bash
./database/verify-deployment-docker.sh
```

### è®¿é—®åº”ç”¨

- å‰ç«¯ï¼šhttp://127.0.0.1:5173
- åç«¯ï¼šhttp://localhost:3001
- pgAdminï¼šhttp://localhost:5050

### é»˜è®¤ç®¡ç†å‘˜è´¦å·

- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`
- âš ï¸ **è¯·ç™»å½•åç«‹å³ä¿®æ”¹å¯†ç ï¼**

## ğŸ“Š åŒ…å«çš„åŠŸèƒ½

éƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹æ‰€æœ‰åŠŸèƒ½ï¼š

### æ ¸å¿ƒåŠŸèƒ½
- âœ… ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- âœ… æ™ºèƒ½å¡ç‰‡è®°å½•
- âœ… æ—¥ç¨‹ç®¡ç†
- âœ… æ ‡ç­¾ç³»ç»Ÿ
- âœ… æ™ºèƒ½æ¨¡æ¿
- âœ… é™„ä»¶æ”¯æŒ
- âœ… å†²çªæ£€æµ‹

### API ä½¿ç”¨æ¬¡æ•°é™åˆ¶ ğŸ†•
- âœ… æ³¨å†Œç”¨æˆ·ï¼š100 æ¬¡ AI åŠŸèƒ½è°ƒç”¨
- âœ… å¿«æ·ç™»å½•ç”¨æˆ·ï¼š50 æ¬¡ AI åŠŸèƒ½è°ƒç”¨
- âœ… è‡ªåŠ¨è¯†åˆ«ç”¨æˆ·ç±»å‹
- âœ… ä½¿ç”¨æ¬¡æ•°ç»Ÿè®¡å’Œç®¡ç†
- âœ… ç®¡ç†å‘˜é‡ç½®åŠŸèƒ½

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### Docker ç›¸å…³

```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs -f cogniflow-postgres

# è¿›å…¥æ•°æ®åº“
docker exec -it cogniflow-postgres psql -U cogniflow_user -d cogniflow

# åœæ­¢å®¹å™¨
docker-compose down

# é‡å¯å®¹å™¨
docker-compose restart

# æŸ¥çœ‹æ‰€æœ‰è¡¨
docker exec cogniflow-postgres psql -U cogniflow_user -d cogniflow -c '\dt'
```

### æ•°æ®åº“ç®¡ç†

```bash
# æŸ¥çœ‹ç”¨æˆ·ä½¿ç”¨æƒ…å†µ
docker exec cogniflow-postgres psql -U cogniflow_user -d cogniflow -c "
SELECT 
  username,
  account_type,
  api_usage_count as used,
  max_api_usage as max,
  (max_api_usage - api_usage_count) as remaining
FROM users
ORDER BY api_usage_count DESC;
"

# é‡ç½®æ‰€æœ‰ç”¨æˆ·ä½¿ç”¨æ¬¡æ•°
docker exec cogniflow-postgres psql -U cogniflow_user -d cogniflow -c "
UPDATE users SET api_usage_count = 0, usage_reset_at = CURRENT_TIMESTAMP;
"
```

## â“ å¸¸è§é—®é¢˜

### Q: å·²æœ‰æ•°æ®æ€ä¹ˆåŠï¼Ÿ

A: `deploy-all.sh` ä¼šåˆ é™¤æ‰€æœ‰ç°æœ‰æ•°æ®ã€‚å¦‚éœ€ä¿ç•™æ•°æ®ï¼Œè¯·å…ˆå¤‡ä»½ï¼š

```bash
# å¤‡ä»½æ•°æ®åº“
docker exec cogniflow-postgres pg_dump -U cogniflow_user cogniflow > backup.sql

# éƒ¨ç½²åæ¢å¤
docker exec -i cogniflow-postgres psql -U cogniflow_user -d cogniflow < backup.sql
```

### Q: éƒ¨ç½²å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. Docker æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. ç«¯å£ 5432ã€5050ã€3001ã€5173 æ˜¯å¦è¢«å ç”¨
3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
4. æ¸…ç†æ®‹ç•™å®¹å™¨åé‡è¯•

```bash
# æ¸…ç†æ‰€æœ‰å®¹å™¨å’Œå·
docker-compose down -v

# é‡æ–°éƒ¨ç½²
./deploy-all.sh
```

### Q: å¦‚ä½•æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Ÿ

A: æ‹‰å–æœ€æ–°ä»£ç åé‡æ–°è¿è¡Œéƒ¨ç½²è„šæœ¬ï¼š

```bash
git pull
./deploy-all.sh
```

### Q: æ˜¯å¦éœ€è¦è¿ç§»è„šæœ¬ï¼Ÿ

A: **ä¸éœ€è¦**ã€‚`deploy-all.sh` åŒ…å«æ‰€æœ‰æœ€æ–°åŠŸèƒ½ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚æ¯æ¬¡éƒ¨ç½²éƒ½æ˜¯å®Œæ•´çš„å…¨æ–°éƒ¨ç½²ã€‚

## ğŸ¯ æœ€ä½³å®è·µ

### å¼€å‘ç¯å¢ƒ

1. ä½¿ç”¨ `deploy-all.sh` è¿›è¡Œåˆå§‹éƒ¨ç½²
2. æ—¥å¸¸å¼€å‘ä½¿ç”¨ `pnpm run dev:postgres` å¯åŠ¨æœåŠ¡
3. éœ€è¦é‡ç½®æ•°æ®æ—¶å†æ¬¡è¿è¡Œ `deploy-all.sh`

### ç”Ÿäº§ç¯å¢ƒ

1. **å¿…é¡»**ä¿®æ”¹é»˜è®¤å¯†ç 
2. é…ç½®æ­£ç¡®çš„ç¯å¢ƒå˜é‡
3. è®¾ç½®å®šæœŸå¤‡ä»½
4. é…ç½®æ—¥å¿—ç›‘æ§

### æ•°æ®å¤‡ä»½

å»ºè®®å®šæœŸå¤‡ä»½ï¼š

```bash
# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p backups

# å®šæœŸå¤‡ä»½è„šæœ¬
docker exec cogniflow-postgres pg_dump -U cogniflow_user cogniflow > "backups/backup_$(date +%Y%m%d_%H%M%S).sql"
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- åŠŸèƒ½è¯´æ˜ï¼š`docs/features/API_USAGE_LIMITS.md`
- å®Œæ•´éƒ¨ç½²è„šæœ¬ï¼š`deploy-all.sh`
- æ•°æ®åº“è„šæœ¬ï¼š`database/deploy.sql`

---

**éƒ¨ç½²é‡åˆ°é—®é¢˜ï¼Ÿ** è¯·æŸ¥çœ‹æ—¥å¿—æˆ–æäº¤ Issueã€‚

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼** ğŸ‰
