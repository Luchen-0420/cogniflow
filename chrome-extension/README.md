# Cogniflow Chrome 浏览器插件

一个简洁高效的 Chrome 浏览器插件，选中文本后一键保存到 Cogniflow 笔记卡片。

## 功能特性

- ✅ **快捷菜单栏** - 选中文本后自动显示快捷菜单，包含"笔记"选项
- ✅ **一键保存** - 点击"笔记"选项即可快速保存到笔记卡片
- ✅ **右键快捷保存** - 选中文本后右键，选择"保存选中内容到 Cogniflow"
- ✅ **智能提示** - 保存成功/失败都有清晰的提示消息
- ✅ **本地测试配置** - 硬编码配置，无需手动设置

## 快速开始

### 1. 加载插件

1. 打开 Chrome 浏览器
2. 访问 `chrome://extensions/`
3. 开启右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择 `chrome-extension` 目录

### 2. 登录账号

1. 点击浏览器工具栏中的插件图标
2. 在登录界面输入：
   - **用户名**：你的 Cogniflow 用户名
   - **密码**：你的密码
   - **API 地址**：默认 `http://localhost:3001/api`（可修改）
3. 点击"登录"按钮
4. 登录成功后会自动保存 token，无需再次登录

### 3. 开始使用

**方式一：快捷菜单栏（推荐）**
1. 在任意网页中选中文本
2. 选中文本上方会自动出现快捷菜单栏
3. 点击菜单栏中的"笔记"选项即可保存

**方式二：右键菜单**
1. 在网页中选中文本
2. 右键点击
3. 选择"保存选中内容到 Cogniflow"

## 使用说明

### 快捷菜单栏

- 选中文本后，菜单栏会自动出现在选中文本的上方居中位置
- 菜单栏包含"笔记"选项，点击即可保存
- 点击后显示"保存中..."状态
- 保存成功后显示绿色提示，菜单栏自动消失
- 保存失败时显示红色错误提示
- 点击页面其他地方或滚动页面时，菜单栏会自动隐藏

### 右键菜单

- 选中文本后右键，菜单中会出现"保存选中内容到 Cogniflow"选项
- 点击后直接保存，无需额外操作

## 文件结构

```
chrome-extension/
├── manifest.json          # 插件配置文件
├── content.js             # 内容脚本（浮动按钮逻辑）
├── content.css            # 浮动按钮样式
├── background.js          # 后台脚本（API 请求处理）
├── icons/                 # 图标目录
└── README.md              # 本文件
```

## 配置说明

### 登录和 Token 管理

- Token 会自动保存到 Chrome 的同步存储中
- 登录后无需再次输入，除非主动退出登录
- Token 过期时会提示重新登录
- 可以在插件 popup 中查看登录状态和退出登录

### 修改 API 地址

在登录界面可以修改 API 地址，默认是 `http://localhost:3001/api`。修改后需要重新登录。

## 技术细节

### API 接口

插件使用以下 API 端点：

- `POST /api/items` - 创建笔记条目

### 数据格式

保存的笔记数据：

```json
{
  "raw_text": "选中的文本内容",
  "type": "note",
  "title": "网页标题",
  "description": "内容摘要（前200字符）",
  "url": "来源网页 URL",
  "url_title": "网页标题",
  "tags": ["网页保存"],
  "priority": "medium",
  "status": "pending"
}
```

### 权限说明

- `activeTab` - 访问当前活动标签页
- `scripting` - 注入内容脚本
- `contextMenus` - 创建右键菜单
- `host_permissions` - 访问 API 服务器

## 故障排除

### 保存失败

1. **检查 Token 配置**
   - 确认 `background.js` 中的 `AUTH_TOKEN` 已正确填写
   - Token 可能已过期，重新获取并更新

2. **检查 API 地址**
   - 确认 `API_URL` 指向正确的服务器地址
   - 确认服务器正在运行

3. **检查网络连接**
   - 确认可以访问 API 服务器
   - 查看浏览器控制台的错误信息

### 快捷菜单栏不显示

1. 刷新页面（插件需要在页面加载后注入）
2. 确认已选中文本（不是空白）
3. 菜单栏会显示在选中文本的上方，注意查看
4. 检查浏览器控制台是否有错误

### 右键菜单不显示

1. 确认已选中文本
2. 重新加载插件
3. 检查 `manifest.json` 中的 `contextMenus` 权限

## 开发说明

### 调试

1. **调试 content script**：
   - 在目标网页打开开发者工具
   - 在 Console 中查看日志

2. **调试 background script**：
   - 访问 `chrome://extensions/`
   - 找到插件，点击"检查视图"下的"service worker"

3. **重新加载插件**：
   - 修改代码后，在 `chrome://extensions/` 页面点击插件的"重新加载"按钮

### 修改样式

编辑 `content.css` 文件来自定义浮动按钮和提示消息的样式。

## 更新日志

### v1.0.0 (2025-01-XX)

- 初始版本
- 支持选中文本后浮动按钮保存
- 支持右键菜单快捷保存
- 本地测试配置（硬编码）
