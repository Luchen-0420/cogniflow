#!/bin/bash

# 流程优化测试脚本
# 测试新的登录流程

echo "======================================"
echo "  CogniFlow 流程优化测试"
echo "======================================"
echo ""

echo "✅ 已完成的优化："
echo ""
echo "1. 首页访问优化"
echo "   - 移除了首页的登录保护"
echo "   - 用户可以直接访问首页查看产品界面"
echo ""

echo "2. 登录提示弹窗"
echo "   - 创建了 LoginDialog 组件"
echo "   - 当用户首次在输入框输入时会弹出登录提示"
echo "   - 提示用户登录后可以多端同步数据"
echo ""

echo "3. 快速体验功能"
echo "   - 在登录弹窗和登录页面都添加了'快速体验'按钮"
echo "   - 点击后自动创建临时账号（格式：guest_时间戳_随机码）"
echo "   - 自动生成密码并显示给用户保存"
echo "   - 用户可以立即开始使用所有功能"
echo ""

echo "======================================"
echo "  测试步骤"
echo "======================================"
echo ""

echo "步骤 1: 启动开发服务器"
echo "  命令: npm run dev"
echo ""

echo "步骤 2: 访问首页"
echo "  - 打开浏览器访问 http://localhost:5173"
echo "  - 应该能直接看到 Dashboard 页面"
echo "  - 不会被重定向到登录页"
echo ""

echo "步骤 3: 测试登录弹窗"
echo "  - 点击快速输入框开始输入"
echo "  - 应该会弹出登录提示对话框"
echo "  - 对话框提示用户登录后可多端同步"
echo ""

echo "步骤 4: 测试快速体验功能"
echo "  - 在登录弹窗中点击'快速体验（自动创建账号）'"
echo "  - 系统自动创建临时账号"
echo "  - 显示账号信息（用户名和密码）"
echo "  - 自动登录并可以使用所有功能"
echo ""

echo "步骤 5: 测试完整登录流程"
echo "  - 访问 /login 页面"
echo "  - 同样可以使用'快速体验'功能"
echo "  - 也可以使用正常的注册和登录功能"
echo ""

echo "======================================"
echo "  预期行为"
echo "======================================"
echo ""
echo "✓ 首页可以在未登录状态下访问"
echo "✓ 首次输入时提示登录"
echo "✓ 快速体验功能正常工作"
echo "✓ 创建的临时账号可以正常使用"
echo "✓ 所有原有功能保持不变"
echo ""

echo "======================================"
echo "  需要的环境"
echo "======================================"
echo ""

# 检查是否配置了后端
if [ -f ".env" ]; then
  if grep -q "VITE_USE_POSTGRES=true" .env; then
    echo "⚙️  当前使用 PostgreSQL 后端"
    echo "   确保后端服务正在运行：npm run server"
  else
    echo "⚙️  当前使用 IndexedDB 本地存储"
    echo "   无需额外后端服务"
  fi
else
  echo "⚠️  未找到 .env 文件"
  echo "   默认使用 IndexedDB 本地存储"
fi

echo ""
echo "======================================"
echo "  开始测试"
echo "======================================"
echo ""

# 提示用户启动服务
read -p "是否立即启动开发服务器？(y/n) " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
  echo "🚀 启动开发服务器..."
  npm run dev
fi
